<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAME HUB (rex.io)</title>
    <style>
        /* --- å…¨å±€æ¨£å¼èˆ‡å­—é«”è¨­å®š --- */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');

        :root {
            --primary-color: #00aaff;
            --card-bg: rgba(20, 20, 30, 0.65);
            --text-color: #f0f0f0;
            --text-muted: #a0a0b0;
            --border-color: rgba(255, 255, 255, 0.2);
            --modal-bg: rgba(20, 20, 30, 0.95); /* æ¨¡æ…‹æ¡†å…§éƒ¨èƒŒæ™¯ */
            --modal-border: rgba(0, 170, 255, 0.8); /* æ¨¡æ…‹æ¡†é‚Šæ¡†é¡è‰² */
            --control-bg: rgba(30, 30, 45, 0.9); /* æ§åˆ¶å€èƒŒæ™¯ */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: #050510; 
            color: var(--text-color); 
            overflow-x: hidden; 
            transition: overflow 0.3s ease; /* ç‚º body overflow è®ŠåŒ–æ·»åŠ éæ¸¡ */
        }
        /* ç•¶æ¨¡æ…‹æ¡†æ‰“é–‹æ™‚é˜»æ­¢ä¸»é é¢æ»¾å‹• */
        body.modal-open {
            overflow: hidden;
        }

        /* --- å‹•æ…‹èƒŒæ™¯è¼ªæ’­ --- */
        .background-slideshow { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1; list-style: none; }
        .background-slideshow li {
            width: 100%; height: 100%; position: absolute; top: 0; left: 0;
            background-size: cover; background-position: center center;
            opacity: 0; 
            animation: imageAnimation 60s linear infinite;
        }
        .background-slideshow li:nth-child(1) { background-image: url('images/bg-1.jpg'), url('https://images.unsplash.com/photo-1579546929518-9e396f3cc809?auto=format&fit=crop&w=1470&q=80'); }
        .background-slideshow li:nth-child(2) { background-image: url('images/bg-2.jpg'), url('https://images.unsplash.com/photo-1554141311-929929384501?auto=format&fit=crop&w=1394&q=80'); animation-delay: 6s; }
        .background-slideshow li:nth-child(3) { background-image: url('images/bg-3.jpg'), url('https://images.unsplash.com/photo-1511447333015-45b65e60f6d5?auto=format&fit=crop&w=1555&q=80'); animation-delay: 12s; }
        .background-slideshow li:nth-child(4) { background-image: url('images/bg-4.jpg'), url('https://images.unsplash.com/photo-1604079628040-94301bb21b91?auto=format&fit=crop&w=1374&q=80'); animation-delay: 18s; }
        .background-slideshow li:nth-child(5) { background-image: url('images/bg-5.jpg'), url('https://images.unsplash.com/photo-1507525428034-b723a9ce6890?auto=format&fit=crop&w=1470&q=80'); animation-delay: 24s; }
        .background-slideshow li:nth-child(6) { background-image: url('images/bg-6.jpg'), url('https://images.unsplash.com/photo-1557682250-33bd709cbe85?auto=format&fit=crop&w=1429&q=80'); animation-delay: 30s; }
        .background-slideshow li:nth-child(7) { background-image: url('images/bg-7.jpg'), url('https://images.unsplash.com/photo-1553356084-58ef4a67b2a7?auto=format&fit=crop&w=1374&q=80'); animation-delay: 36s; }
        .background-slideshow li:nth-child(8) { background-image: url('images/bg-8.jpg'), url('https://images.unsplash.com/photo-1618005198919-d3d4b5a92ead?auto=format&fit=crop&w=1548&q=80'); animation-delay: 42s; }
        .background-slideshow li:nth-child(9) { background-image: url('images/bg-9.jpg'), url('https://images.unsplash.com/photo-1579546929662-711aa81148cf?auto=format&fit=crop&w=1470&q=80'); animation-delay: 48s; }
        .background-slideshow li:nth-child(10) { background-image: url('images/bg-10.jpg'), url('https://images.unsplash.com/photo-1605792637384-5275a3933b39?auto=format&fit=crop&w=1470&q=80'); animation-delay: 54s; }
        
        @keyframes imageAnimation {
            0% { opacity: 0; animation-timing-function: ease-in; }
            1% { opacity: 1; }
            9% { opacity: 1; }
            10% { opacity: 0; }
            100% { opacity: 0; }
        }

        /* --- å´é‚Šæ¬„èˆ‡æ¼¢å ¡é¸å–® --- */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 260px;
            height: 100vh;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            z-index: 1001; /* å¿…é ˆæ¯”é®ç½©å±¤é«˜ */
            transform: translateX(-100%);
            transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            padding-top: 5rem;
            border-right: 1px solid var(--border-color);
        }
        .sidebar ul { list-style: none; }
        .sidebar ul li a {
            display: block; padding: 1rem 2rem; color: var(--text-color);
            text-decoration: none; font-size: 1.1rem; font-weight: 500;
            transition: background-color 0.3s, color 0.3s;
        }
        .sidebar ul li a:hover, .sidebar ul li a.active {
            background-color: rgba(0, 170, 255, 0.2);
            color: var(--primary-color);
        }
        .sidebar-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0, 0, 0, 0.5); z-index: 1000;
            opacity: 0; pointer-events: none;
            transition: opacity 0.35s ease-in-out;
        }
        .sidebar-toggle-btn {
            background: none; border: none; cursor: pointer; padding: 10px;
            z-index: 1002; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
            display: flex; flex-direction: column; justify-content: space-around;
            width: 40px; height: 40px;
        }
        .sidebar-toggle-btn .line {
            width: 100%; height: 3px; background-color: var(--text-color);
            border-radius: 3px; transition: all 0.3s ease-in-out;
        }

        /* ç•¶å´é‚Šæ¬„æ‰“é–‹æ™‚çš„æ¨£å¼è®ŠåŒ– */
        body.sidebar-open .sidebar { transform: translateX(0); }
        body.sidebar-open .sidebar-overlay { opacity: 1; pointer-events: auto; }
        body.sidebar-open .sidebar-toggle-btn .line1 { transform: rotate(45deg) translate(7px, 7px); }
        body.sidebar-open .sidebar-toggle-btn .line2 { opacity: 0; }
        body.sidebar-open .sidebar-toggle-btn .line3 { transform: rotate(-45deg) translate(7px, -7px); }


        /* --- é ‚éƒ¨åŠé€æ˜é¸æ“‡å€ --- */
        header {
            position: sticky; top: 0; z-index: 100; padding: 1rem 2rem; background: rgba(10, 10, 20, 0.5);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-bottom: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; 
            gap: 1.5rem;
        }
        .logo { font-weight: 700; letter-spacing: 2px; text-shadow: 0 0 10px var(--primary-color); font-size: clamp(1.5rem, 5vw + 0.5rem, 1.8rem); }

        /* --- Collapsible Menu Styles --- */
        #toggle-filters-btn {
            display: none;
            padding: 0.6rem 1.2rem; font-size: 1rem; font-weight: 500;
            background-color: rgba(255, 255, 255, 0.1); color: var(--text-color);
            border: 1px solid var(--border-color); border-radius: 20px; cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
        }
        .collapsible-menu {
            display: flex; align-items: center; gap: 1rem;
            transition: max-height 0.4s ease-in-out, opacity 0.4s ease-in-out, padding 0.4s ease-in-out;
        }
        .search-wrapper { flex-shrink: 0; }
        #search-box {
            padding: 0.6rem 1rem; border-radius: 20px; border: 1px solid var(--border-color); background: rgba(255, 255, 255, 0.1);
            color: var(--text-color); font-size: 1rem; transition: all 0.3s ease;
        }
        #search-box:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 15px rgba(0, 170, 255, 0.5); }
        .filter-buttons { display: flex; flex-wrap: wrap; gap: 0.5rem; }
        .filter-buttons button {
            padding: 0.6rem 1.2rem; font-size: 1rem; font-weight: 500; color: var(--text-muted); background: transparent;
            border: 1px solid var(--border-color); border-radius: 20px; cursor: pointer; transition: all 0.3s ease;
        }
        .filter-buttons button:hover, .filter-buttons button.active {
             color: #fff; background: var(--primary-color); border-color: var(--primary-color); box-shadow: 0 0 10px rgba(0, 170, 255, 0.7);
        }

        /* --- æ»¾å‹•é é¢æ¨è–¦ --- */
        .scrolling-recommendations { width: 100%; background: linear-gradient(90deg, #ff8a00, #e52e71); color: white; padding: 0.5rem 0; overflow: hidden; white-space: nowrap; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .scrolling-text { display: inline-block; padding-left: 100%; animation: scroll-left 30s linear infinite; font-weight: 500; font-size: 1.1rem; }
        .scrolling-text span { margin: 0 1.5rem; }
        @keyframes scroll-left { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
        
        /* --- å¡ç‰‡å®¹å™¨èˆ‡æ¨£å¼ --- */
        main { padding: 2rem; }
        .card-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; }
        .card {
            background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 16px; overflow: hidden; text-decoration: none; color: var(--text-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease; backdrop-filter: blur(5px); display: flex; flex-direction: column;
            cursor: pointer; /* è¡¨ç¤ºå¯é»æ“Š */
        }
        .card:hover { transform: translateY(-10px); box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4); border-color: var(--primary-color); }
        .card:active { transform: translateY(-2px) scale(0.98); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3); }
        .card-image { width: 100%; height: 200px; background-size: cover; background-position: center; }
        .card-content { padding: 1.5rem; display: flex; flex-direction: column; flex-grow: 1; }
        .card h3 { margin-bottom: 0.5rem; font-weight: 700; font-size: clamp(1.25rem, 4vw + 0.5rem, 1.5rem); }
        .card p { font-size: 1rem; color: var(--text-muted); line-height: 1.6; flex-grow: 1; margin-bottom: 1rem; }
        .card-footer { display: flex; justify-content: space-between; align-items: center; margin-top: auto; }
        .tags-container { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .category-tag { padding: 0.3rem 0.8rem; border-radius: 12px; font-size: 0.8rem; font-weight: 500; }
        .category-tag.mobile-game { background-color: #f4511e; color: white; }
        .category-tag.desktop-game { background-color: #e53935; color: white; }
        .category-tag.app { background-color: #43a047; color: white; }
        
        /* --- æ¨¡æ…‹è¦–çª—é€šç”¨æ¨£å¼ --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9); /* åŠé€æ˜é»‘è‰²èƒŒæ™¯ */
            backdrop-filter: blur(5px); /* èƒŒæ™¯æ¨¡ç³Šæ•ˆæœ */
            -webkit-backdrop-filter: blur(5px);
            display: none; /* é è¨­éš±è— */
            justify-content: center;
            align-items: center;
            opacity: 0; /* ç”¨æ–¼éæ¸¡æ•ˆæœ */
            transition: opacity 0.3s ease;
            pointer-events: none; /* éš±è—æ™‚ä¸é˜»æ“‹é»æ“Š */
        }
        .modal-overlay.is-active {
            opacity: 1;
            pointer-events: auto; /* é¡¯ç¤ºæ™‚å…è¨±é»æ“Š */
        }

        .modal-content {
            position: relative;
            background: var(--modal-bg);
            border-radius: 16px;
            overflow: hidden;
            border: 2px solid var(--modal-border);
            box-shadow: 0 0 40px var(--primary-color);
            display: flex;
            flex-direction: column;
        }

        .modal-controls {
            display: flex;
            justify-content: flex-end; /* æŒ‰éˆ•é å³å°é½Š */
            gap: 10px;
            padding: 10px;
            background: var(--control-bg);
            height: 60px; /* å›ºå®šé«˜åº¦ */
            flex-shrink: 0; /* ä¸æœƒè¢«å£“ç¸® */
            border-top: 1px solid var(--border-color);
        }

        .modal-control-btn {
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-color);
            background-color: rgba(0, 170, 255, 0.2);
            border: 1px solid var(--primary-color);
            border-radius: 25px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
        }

        .modal-control-btn:hover {
            background-color: var(--primary-color);
            box-shadow: 0 0 15px rgba(0, 170, 255, 0.7);
            transform: translateY(-2px);
        }

        .modal-control-btn:active {
            transform: translateY(0);
            box-shadow: none;
        }

        /* --- éŠæˆ²å…§åµŒæ¨¡æ…‹è¦–çª—æ¨£å¼ (è¦†å¯«é€šç”¨æ¨£å¼) --- */
        #gameModal { z-index: 2000; }
        #gameModal .modal-content {
            width: 95%; /* å¹¾ä¹ä½”æ»¿ç•«é¢çš„å¯¬åº¦ */
            height: 95%; /* å¹¾ä¹ä½”æ»¿ç•«é¢çš„é«˜åº¦ */
        }
        #gameIframe {
            width: 100%;
            height: calc(100% - 60px); /* ç•™å‡ºåº•éƒ¨ç©ºé–“çµ¦æ§åˆ¶æŒ‰éˆ• */
            border: none;
            background-color: #050510; /* åŠ è¼‰æ™‚çš„èƒŒæ™¯è‰² */
        }

        /* --- è¨­å®šæ¨¡æ…‹è¦–çª—æ¨£å¼ --- */
        #settingsModal { z-index: 2001; } /* æ¯”éŠæˆ²æ¨¡æ…‹æ¡†é«˜ */
        #settingsModal .modal-content {
            width: clamp(300px, 80%, 500px); /* è¼ƒå°çš„è¨­å®šæ¡† */
            height: auto; /* å…§å®¹è‡ªé©æ‡‰ */
            padding: 1.5rem;
            text-align: center;
        }
        #settingsModal h3 {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
            text-shadow: 0 0 8px rgba(0, 170, 255, 0.5);
        }
        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding: 0.8rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .setting-item:last-child { border-bottom: none; margin-bottom: 0; }
        .setting-item label {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-color);
            flex-grow: 1;
            text-align: left;
        }
        /* éŸ³é‡æ»‘å¡Šæ¨£å¼ */
        #volumeSlider {
            -webkit-appearance: none;
            appearance: none;
            width: 60%; /* æ»‘å¡Šå¯¬åº¦ */
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            border-radius: 4px;
            transition: opacity .2s;
            cursor: pointer;
        }
        #volumeSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            border: 2px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 170, 255, 0.8);
        }
        #volumeSlider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            border: 2px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 170, 255, 0.8);
        }
        /* éŸ³é‡åœ–ç¤ºæŒ‰éˆ• */
        .volume-icon-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: color 0.3s;
        }
        .volume-icon-btn:hover { color: white; }
        .volume-icon-btn:disabled {
            cursor: not-allowed;
            opacity: 0.5;
            color: var(--text-muted);
        }
        #volumeSlider:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* --- æ­Œæ›²åˆ—è¡¨æ¨£å¼ --- */
        .song-list-container {
            max-height: 250px; /* é™åˆ¶é«˜åº¦ï¼Œä½¿å…¶å¯æ»¾å‹• */
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 5px;
            margin-bottom: 1.5rem;
            background-color: rgba(0, 0, 0, 0.3);
            text-align: left; /* è®“åˆ—è¡¨å…§å®¹é å·¦ */
        }
        .song-list-container ul {
            list-style: none; /* ç§»é™¤åˆ—è¡¨é» */
        }
        .song-item {
            padding: 0.8rem 1rem;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .song-item:last-child { border-bottom: none; }
        .song-item:hover {
            background-color: rgba(0, 170, 255, 0.1);
            color: white;
        }
        .song-item.active {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
            box-shadow: inset 0 0 10px rgba(0, 170, 255, 0.5);
        }
        .song-item.active::before {
            content: 'â–¶'; /* æ’­æ”¾åœ–ç¤º */
            display: inline-block;
            margin-right: 5px;
            color: white;
        }

        /* å–®æ›²å¾ªç’°æŒ‰éˆ• */
        #singleLoopToggleBtn {
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-color);
            background-color: rgba(0, 170, 255, 0.2);
            border: 1px solid var(--primary-color);
            border-radius: 25px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.3s;
            margin-bottom: 1rem; /* å¢åŠ èˆ‡ä¸‹é¢æ§åˆ¶æŒ‰éˆ•çš„è·é›¢ */
        }
        #singleLoopToggleBtn:hover {
            background-color: var(--primary-color);
            box-shadow: 0 0 15px rgba(0, 170, 255, 0.7);
            transform: translateY(-2px);
        }
        #singleLoopToggleBtn.active {
            background-color: var(--primary-color);
            box-shadow: 0 0 15px rgba(0, 170, 255, 0.7);
        }
        #singleLoopToggleBtn:active {
            transform: translateY(0);
            box-shadow: none;
        }


        /* --- MOBILE OPTIMIZATIONS (max-width: 768px) --- */
        @media (max-width: 768px) {
            header { padding: 1rem; }
            .sidebar-toggle-btn { transform: scale(0.85); } /* æ‰‹æ©Ÿç‰ˆæŒ‰éˆ•ç¨å°ä¸€é» */
            #toggle-filters-btn { display: flex; }
            .collapsible-menu {
                flex-basis: 100%; flex-direction: column; overflow: hidden;
                max-height: 0; opacity: 0; padding: 0;
            }
            .collapsible-menu.is-open { max-height: 500px; opacity: 1; padding: 1.5rem 0 0.5rem 0; }
            .search-wrapper { width: 100%; }
            #search-box { width: 100%; }
            .filter-buttons { justify-content: center; }
            main { padding: 1.5rem 1rem; }
            .card-container { grid-template-columns: 1fr; gap: 1.5rem; }
            .card p { line-height: 1.7; }
            .scrolling-text { animation-duration: 40s; }
            
            /* æ‰‹æ©Ÿç‰ˆæ¨¡æ…‹æ¡†èª¿æ•´ */
            #gameModal .modal-content {
                width: 98%;
                height: 98%;
            }
            #settingsModal .modal-content {
                width: 95%;
            }
            .setting-item label { font-size: 1rem; }
            #volumeSlider { width: 50%; } /* æ‰‹æ©Ÿä¸Šæ»‘å¡Šå¯ä»¥çª„ä¸€é» */
            .volume-icon-btn { font-size: 1.3rem; }
            #singleLoopToggleBtn { padding: 0.6rem 1rem; font-size: 0.9rem; }
        }
        
        /* --- Desktop-specific layout (min-width: 769px) --- */
        @media (min-width: 769px) {
            .collapsible-menu {
                flex-grow: 1; /* Allow menu to take up space */
                justify-content: flex-end; /* Align items to the right */
            }
            #search-box {
                width: 280px; /* Set a specific width for the search box */
            }
        }
    </style>
</head>
<body>

    <!-- èƒŒæ™¯éŸ³æ¨‚æ’­æ”¾å™¨ (é è¨­éœéŸ³) -->
    <audio id="backgroundMusic" loop muted></audio>

    <!-- å´é‚Šæ¬„èˆ‡é®ç½©å±¤ -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>
    <nav id="sidebar" class="sidebar">
        <ul>
            <li><a href="#" class="active">ä¸»é </a></li>
            <li><a href="#" id="settingsLink">è¨­å®š</a></li> <!-- æ–°å¢è¨­å®šé€£çµ -->
        </ul>
    </nav>

    <ul class="background-slideshow">
        <li></li><li></li><li></li><li></li><li></li>
        <li></li><li></li><li></li><li></li><li></li>
    </ul>

    <header>
        <!-- æ¼¢å ¡é¸å–®æŒ‰éˆ• -->
        <button id="sidebar-toggle-btn" class="sidebar-toggle-btn" aria-label="Toggle Menu" aria-expanded="false">
            <span class="line line1"></span>
            <span class="line line2"></span>
            <span class="line line3"></span>
        </button>

        <div class="logo">GameHub</div>
        <button id="toggle-filters-btn" aria-controls="collapsible-menu" aria-expanded="false">ç¯©é¸ â–¼</button>
        <div class="collapsible-menu" id="collapsible-menu">
            <div class="search-wrapper">
                <input type="text" id="search-box" placeholder="æœç´¢ä½œå“åç¨±...">
            </div>
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
                <button class="filter-btn" data-filter="æ‰‹éŠ">æ‰‹éŠ</button>
                <button class="filter-btn" data-filter="æ¡Œæ©ŸéŠæˆ²">æ¡Œæ©ŸéŠæˆ²</button>
                <button class="filter-btn" data-filter="æ‡‰ç”¨">æ‡‰ç”¨</button>
            </div>
        </div>
    </header>
    
    <div class="scrolling-recommendations">
        <div class="scrolling-text">
             <span>ğŸ”¥ ç†±é–€æ¨è–¦ï¼šè²“å’ªå¤§äº‚é¬¥</span><span>âœ¨ æœ€æ–°ä¸Šç·šï¼šå–®å­—å¡</span><span>ğŸ® ç¶“å…¸å¿…ç©ï¼šé»ƒé‡‘ç¤¦å·¥</span>
             <span>ğŸŒ² å†’éšªæ¢ç´¢ï¼šå¢æ—æ±‚ç”Ÿ</span><span>ğŸš€ æ¡Œæ©Ÿå°ˆå±¬ï¼šChromaShock Arena</span>
        </div>
    </div>

    <main>
        <div class="card-container" id="card-container">
             <p style="color: var(--text-muted); font-size: 1.2rem; grid-column: 1 / -1; text-align: center;">æ­£åœ¨è¼‰å…¥ä½œå“ä¸­ï¼Œè«‹ç¨å€™...</p>
        </div>
    </main>

    <!-- éŠæˆ²å…§åµŒæ¨¡æ…‹è¦–çª— -->
    <div id="gameModal" class="modal-overlay">
        <div class="modal-content">
            <iframe id="gameIframe" src="" frameborder="0" allowfullscreen></iframe>
            <div class="modal-controls">
                <button id="openInNewTabBtn" class="modal-control-btn">åœ¨æ–°åˆ†é é–‹å•Ÿ</button>
                <button id="closeGameModalBtn" class="modal-control-btn">é—œé–‰</button>
            </div>
        </div>
    </div>

    <!-- è¨­å®šæ¨¡æ…‹è¦–çª— -->
    <div id="settingsModal" class="modal-overlay">
        <div class="modal-content">
            <h3>è¨­å®š</h3>
            <div class="setting-item">
                <label for="volumeSlider">èƒŒæ™¯éŸ³æ¨‚éŸ³é‡</label>
                <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0">
                <button id="muteToggleBtn" class="volume-icon-btn" aria-label="Toggle Mute">
                    <span class="mute-icon">ğŸ”‡</span> <!-- éœéŸ³åœ–ç¤º -->
                </button>
            </div>
            <button id="singleLoopToggleBtn"><span>å–®æ›²å¾ªç’° ğŸ”</span></button> <!-- æ–°å¢å–®æ›²å¾ªç’°æŒ‰éˆ• -->

            <div class="song-list-container">
                <ul id="songList">
                    <!-- æ­Œæ›²åˆ—è¡¨å°‡ç”± JavaScript æ¸²æŸ“åˆ°é€™è£¡ -->
                </ul>
            </div>

            <div class="modal-controls" style="border-top: none; padding-top: 0; justify-content: center;">
                <button id="closeSettingsModalBtn" class="modal-control-btn">é—œé–‰</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- å…¨å±€æ¨¡æ…‹æ¡†æ§åˆ¶ ---
        function showModal(modalElement) {
            modalElement.style.display = 'flex';
            requestAnimationFrame(() => {
                modalElement.classList.add('is-active');
                document.body.classList.add('modal-open'); 
            });
        }

        function hideModal(modalElement) {
            modalElement.classList.remove('is-active');
            // Only remove modal-open if no other modal is active
            setTimeout(() => {
                modalElement.style.display = 'none';
                if (!document.querySelector('.modal-overlay.is-active')) {
                    document.body.classList.remove('modal-open');
                }
            }, 300); 
        }

        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (event) => {
                if (event.target === overlay) {
                    hideModal(overlay);
                }
            });
        });
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                // æ‰¾åˆ°æœ€ä¸Šå±¤çš„æ¨¡æ…‹æ¡†ä¸¦é—œé–‰å®ƒ
                const activeModals = Array.from(document.querySelectorAll('.modal-overlay.is-active'));
                if (activeModals.length > 0) {
                    // å‡è¨­æœ€å¾Œä¸€å€‹æ˜¯æœ€æ–°æ‰“é–‹çš„ï¼Œæˆ–æœ€é ‚å±¤çš„
                    hideModal(activeModals[activeModals.length - 1]);
                }
            }
        });


        // --- å´é‚Šæ¬„æ§åˆ¶ ---
        const sidebarToggleBtn = document.getElementById('sidebar-toggle-btn');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');
        
        const toggleSidebar = () => {
            document.body.classList.toggle('sidebar-open');
            const isSidebarOpen = document.body.classList.contains('sidebar-open');
            sidebarToggleBtn.setAttribute('aria-expanded', isSidebarOpen);
        };

        sidebarToggleBtn.addEventListener('click', toggleSidebar);
        sidebarOverlay.addEventListener('click', toggleSidebar);
        // --- å´é‚Šæ¬„æ§åˆ¶çµæŸ ---


        // --- éŠæˆ²å…§åµŒæ¨¡æ…‹è¦–çª—æ§åˆ¶ ---
        const gameModal = document.getElementById('gameModal');
        const gameIframe = document.getElementById('gameIframe');
        const closeGameModalBtn = document.getElementById('closeGameModalBtn');
        const openInNewTabBtn = document.getElementById('openInNewTabBtn');

        function showGameModal(url) {
            gameIframe.src = url;
            openInNewTabBtn.onclick = () => window.open(url, '_blank'); 
            showModal(gameModal);
        }

        function hideGameModal() {
            hideModal(gameModal);
            gameIframe.src = ''; 
        }

        closeGameModalBtn.addEventListener('click', hideGameModal);


        // --- èƒŒæ™¯éŸ³æ¨‚æ’­æ”¾æ§åˆ¶ ---
        const settingsLink = document.getElementById('settingsLink');
        const settingsModal = document.getElementById('settingsModal');
        const closeSettingsModalBtn = document.getElementById('closeSettingsModalBtn');
        const backgroundMusic = document.getElementById('backgroundMusic');
        const volumeSlider = document.getElementById('volumeSlider');
        const muteToggleBtn = document.getElementById('muteToggleBtn');
        const muteIcon = muteToggleBtn.querySelector('.mute-icon');
        const singleLoopToggleBtn = document.getElementById('singleLoopToggleBtn'); // æ–°å¢å–®æ›²å¾ªç’°æŒ‰éˆ•
        const songListElement = document.getElementById('songList'); // æ–°å¢æ­Œæ›²åˆ—è¡¨å…ƒç´ 

        // è«‹åœ¨æ­¤è™•å¡«å¯«æ‚¨çš„ MP3 æª”æ¡ˆè·¯å¾‘èˆ‡åç¨±
        const audioPlaylist = [
            { path: 'images/music1.mp3', name: 'è¼•å¿«èƒŒæ™¯æ¨‚' }, 
            { path: 'images/music2.mp3', name: 'å²è©©æˆ°é¬¥æ›²' }, 
            { path: 'images/music3.mp3', name: 'å¥‡å¹»å†’éšªæ—‹å¾‹' },
            { path: 'images/music4.mp3', name: 'å¯§éœå¤œæ™š' },
            { path: 'images/music5.mp3', name: 'æ­¡æ¨‚éŠæˆ²æ™‚é–“' },
            { path: 'images/music6.mp3', name: 'æœªä¾†ç§‘æŠ€æ„Ÿ' },
            { path: 'images/music7.mp3', name: 'ç¥ç§˜åœ°ç‰¢' },
            { path: 'images/music8.mp3', name: 'å¾©å¤åƒç´ é¢¨' },
            { path: 'images/music9.mp3', name: 'é«˜èƒ½ç¯€å¥' },
            { path: 'images/music10.mp3', name: 'å‹åˆ©å‡±æ­Œ' }
        ];
        let currentAudioIndex = 0;
        let failedAttemptsCount = 0; // è¿½è¹¤é€£çºŒå¤±æ•—çš„æ¬¡æ•¸
        let isSingleLoop = false; // æ§åˆ¶å–®æ›²å¾ªç’°ç‹€æ…‹

        // è¼”åŠ©å‡½æ•¸ï¼šç¦ç”¨éŸ³é‡æ§åˆ¶
        function disableAudioControls() {
            backgroundMusic.pause();
            backgroundMusic.src = '';
            volumeSlider.disabled = true;
            muteToggleBtn.disabled = true;
            singleLoopToggleBtn.disabled = true; // ç¦ç”¨å–®æ›²å¾ªç’°æŒ‰éˆ•
            muteIcon.textContent = 'ğŸ”‡';
            muteToggleBtn.setAttribute('aria-label', 'Audio disabled');
            localStorage.setItem('audioControlsDisabled', 'true');
            console.log("æ‰€æœ‰éŸ³é »æª”æ¡ˆéƒ½ç„¡æ³•è¼‰å…¥æˆ–æ’­æ”¾ï¼Œå·²ç¦ç”¨éŸ³æ¨‚æ§åˆ¶ã€‚");
        }

        // è¼”åŠ©å‡½æ•¸ï¼šå•Ÿç”¨éŸ³é‡æ§åˆ¶
        function enableAudioControls() {
            volumeSlider.disabled = false;
            muteToggleBtn.disabled = false;
            singleLoopToggleBtn.disabled = false; // å•Ÿç”¨å–®æ›²å¾ªç’°æŒ‰éˆ•
            localStorage.setItem('audioControlsDisabled', 'false');
            updateMuteIcon();
        }

        function updateMuteIcon() {
            if (backgroundMusic.muted || backgroundMusic.volume === 0) {
                muteIcon.textContent = 'ğŸ”‡';
                muteToggleBtn.setAttribute('aria-label', 'Unmute');
            } else {
                muteIcon.textContent = 'ğŸ”Š';
                muteToggleBtn.setAttribute('aria-label', 'Mute');
            }
        }

        // æ’­æ”¾æŒ‡å®šç´¢å¼•çš„æ­Œæ›²
        function playAudioByIndex(index, forcePlay = false) {
            if (audioPlaylist.length === 0) {
                disableAudioControls();
                return;
            }

            // ç¢ºä¿ç´¢å¼•åœ¨æœ‰æ•ˆç¯„åœå…§
            index = index % audioPlaylist.length;
            if (index < 0) index = audioPlaylist.length + index; // è™•ç†è² æ•¸ç´¢å¼• (å„˜ç®¡é€™è£¡ä¸æœƒç™¼ç”Ÿ)

            // å¦‚æœæ‰€æœ‰æ­Œæ›²éƒ½å˜—è©¦éä¸”éƒ½å¤±æ•—ï¼Œå‰‡åœæ­¢ (é™¤éæ˜¯å¼·åˆ¶æ’­æ”¾)
            if (failedAttemptsCount >= audioPlaylist.length && !forcePlay) {
                disableAudioControls();
                return;
            }

            currentAudioIndex = index;
            backgroundMusic.src = audioPlaylist[currentAudioIndex].path;
            backgroundMusic.load(); // ç¢ºä¿æ–° src è¢«è¼‰å…¥

            backgroundMusic.loop = isSingleLoop; // å¥—ç”¨å–®æ›²å¾ªç’°è¨­å®š

            const playPromise = backgroundMusic.play();
            if (playPromise !== undefined) {
                playPromise
                    .then(() => {
                        console.log(`æ­£åœ¨æ’­æ”¾: ${audioPlaylist[currentAudioIndex].name}`);
                        failedAttemptsCount = 0; // æˆåŠŸæ’­æ”¾ï¼Œé‡ç½®å¤±æ•—è¨ˆæ•¸
                        enableAudioControls(); // ç¢ºä¿éŸ³é‡æ§åˆ¶æ˜¯å•Ÿç”¨çš„
                        updateSongListUI(); // æ›´æ–°æ­Œæ›²åˆ—è¡¨ UI
                    })
                    .catch(error => {
                        console.warn(`è‡ªå‹•æ’­æ”¾æˆ–è¼‰å…¥å¤±æ•— (${audioPlaylist[currentAudioIndex].name}):`, error);
                        failedAttemptsCount++; // å¢åŠ å¤±æ•—è¨ˆæ•¸
                        
                        // å¦‚æœé€™æ¬¡æ’­æ”¾å¤±æ•—äº†ï¼Œä¸¦ä¸”ä¸æ˜¯å–®æ›²å¾ªç’°æ¨¡å¼ï¼Œæˆ–è€…å³ä½¿æ˜¯å–®æ›²å¾ªç’°ä½†ä¾†æºæª”æ¡ˆéƒ½è¼‰å…¥å¤±æ•—äº†ï¼Œæ‰å˜—è©¦æ’­æ”¾ä¸‹ä¸€é¦–
                        // å¦‚æœæ˜¯å–®æ›²å¾ªç’°ä¸”æ–‡ä»¶å­˜åœ¨ä½†åªæ˜¯è‡ªå‹•æ’­æ”¾è¢«é˜»æ­¢ï¼Œæˆ‘å€‘ä¸æ‡‰è©²è·³åˆ°ä¸‹ä¸€é¦–ï¼Œè€Œæ˜¯ç­‰å¾…ç”¨æˆ¶äº’å‹•
                        if (!isSingleLoop || error.name === 'MediaError' || backgroundMusic.networkState === HTMLMediaElement.NETWORK_EMPTY) {
                             currentAudioIndex = (currentAudioIndex + 1) % audioPlaylist.length;
                             playAudioByIndex(currentAudioIndex); // éæ­¸èª¿ç”¨ï¼Œå˜—è©¦ä¸‹ä¸€é¦–
                        } else {
                            // å¦‚æœæ˜¯å–®æ›²å¾ªç’°æ¨¡å¼ï¼Œä¸”ä¸æ˜¯æ–‡ä»¶è¼‰å…¥éŒ¯èª¤ï¼Œå‰‡åœæ­¢ä¸¦ç­‰å¾…ç”¨æˆ¶äº’å‹•
                            backgroundMusic.pause();
                            updateSongListUI(); // ä¾ç„¶æ›´æ–° UI ç‹€æ…‹
                        }
                    });
            }
        }

        // ç›£è½éŸ³é »è¼‰å…¥å¤±æ•—äº‹ä»¶ (ä¾‹å¦‚æª”æ¡ˆä¸å­˜åœ¨æˆ–æå£)
        backgroundMusic.addEventListener('error', (e) => {
            console.error(`è¼‰å…¥éŸ³é »æª”æ¡ˆå¤±æ•—: ${backgroundMusic.src}. Error code: ${e.target.error.code}. è·³éæ­¤æ›²ã€‚`);
            failedAttemptsCount++; // å¢åŠ å¤±æ•—è¨ˆæ•¸
            currentAudioIndex = (currentAudioIndex + 1) % audioPlaylist.length;
            playAudioByIndex(currentAudioIndex); // å˜—è©¦æ’­æ”¾ä¸‹ä¸€é¦–
        });

        // ç•¶å‰æ­Œæ›²æ’­æ”¾çµæŸæ™‚ï¼Œè‡ªå‹•æ’­æ”¾ä¸‹ä¸€é¦– (åƒ…åœ¨éå–®æ›²å¾ªç’°æ¨¡å¼ä¸‹)
        backgroundMusic.addEventListener('ended', () => {
            // é€™å€‹äº‹ä»¶åªåœ¨ backgroundMusic.loop ç‚º false æ™‚è§¸ç™¼
            // å¦‚æœ isSingleLoop ç‚º trueï¼ŒbackgroundMusic.loop æœƒæ˜¯ trueï¼Œå°è‡´æ­¤äº‹ä»¶ä¸è§¸ç™¼ï¼Œç”±ç€è¦½å™¨è‡ªè¡Œå¾ªç’°
            if (!isSingleLoop) { 
                currentAudioIndex = (currentAudioIndex + 1) % audioPlaylist.length;
                playAudioByIndex(currentAudioIndex);
            }
        });

        function initializeAudioControls() {
            if (audioPlaylist.length === 0) {
                disableAudioControls();
                return;
            }

            // è¼‰å…¥ localStorage ä¸­çš„ç‹€æ…‹
            const audioDisabledPermanently = localStorage.getItem('audioControlsDisabled') === 'true';
            const savedVolume = parseFloat(localStorage.getItem('backgroundVolume'));
            const savedMuted = localStorage.getItem('backgroundMuted') === 'true';
            isSingleLoop = localStorage.getItem('isSingleLoop') === 'true'; // è¼‰å…¥å–®æ›²å¾ªç’°ç‹€æ…‹

            // å¥—ç”¨è¼‰å…¥çš„ç‹€æ…‹
            backgroundMusic.volume = isNaN(savedVolume) ? 0 : savedVolume; // é è¨­éœéŸ³ä¸”éŸ³é‡ç‚º0
            backgroundMusic.muted = savedMuted || true; // é è¨­éœéŸ³
            backgroundMusic.loop = isSingleLoop; // å¥—ç”¨å–®æ›²å¾ªç’°è¨­å®š

            // æ›´æ–° UI
            volumeSlider.value = backgroundMusic.volume;
            if (backgroundMusic.muted) {
                 volumeSlider.value = 0; // éœéŸ³æ™‚æ»‘å¡Šé¡¯ç¤ºç‚º0
            }
            singleLoopToggleBtn.classList.toggle('active', isSingleLoop); // æ›´æ–°å–®æ›²å¾ªç’°æŒ‰éˆ•ç‹€æ…‹
            updateMuteIcon();

            // å¦‚æœä¹‹å‰æ‰€æœ‰éŸ³æ¨‚éƒ½å¤±æ•—äº†ï¼Œå°±ä¿æŒç¦ç”¨
            if (audioDisabledPermanently) {
                disableAudioControls(); 
            } else {
                enableAudioControls(); // ç¢ºä¿å•Ÿç”¨ï¼Œç„¶å¾Œå˜—è©¦æ’­æ”¾
                // ç”±æ–¼ç€è¦½å™¨è‡ªå‹•æ’­æ”¾æ”¿ç­–ï¼Œé€™è£¡çš„ play() å¯èƒ½æœƒå¤±æ•—
                // æœƒåœ¨ playAudioByIndex å…§éƒ¨è™•ç†éŒ¯èª¤å’Œå˜—è©¦ä¸‹ä¸€é¦–
                playAudioByIndex(currentAudioIndex); 
            }

            // äº‹ä»¶ç›£è½å™¨
            volumeSlider.addEventListener('input', () => {
                backgroundMusic.volume = volumeSlider.value;
                backgroundMusic.muted = (volumeSlider.value == 0); // æ»‘åˆ°0è‡ªå‹•éœéŸ³
                localStorage.setItem('backgroundVolume', backgroundMusic.volume);
                localStorage.setItem('backgroundMuted', backgroundMusic.muted);
                updateMuteIcon();
                // å¦‚æœæ˜¯å¾éœéŸ³ç‹€æ…‹è§£é™¤ï¼Œä¸”éŸ³æ¨‚è¢«ç€è¦½å™¨é˜»æ­¢ï¼Œå˜—è©¦æ’­æ”¾
                if (!backgroundMusic.muted && backgroundMusic.paused) {
                    backgroundMusic.play().catch(error => {
                        console.warn("ç„¡æ³•è‡ªå‹•æ’­æ”¾èƒŒæ™¯éŸ³æ¨‚ï¼Œå¯èƒ½éœ€è¦ç”¨æˆ¶å†æ¬¡äº’å‹•ã€‚", error);
                    });
                }
            });

            muteToggleBtn.addEventListener('click', () => {
                backgroundMusic.muted = !backgroundMusic.muted;
                if (!backgroundMusic.muted && backgroundMusic.volume === 0) {
                    backgroundMusic.volume = 0.5; // å¦‚æœå¾éœéŸ³æ¢å¾©ï¼ŒéŸ³é‡è¨­ç‚º0.5
                    volumeSlider.value = 0.5;
                } else if (backgroundMusic.muted) {
                    volumeSlider.value = 0; 
                }
                localStorage.setItem('backgroundMuted', backgroundMusic.muted);
                localStorage.setItem('backgroundVolume', backgroundMusic.volume);
                updateMuteIcon();
                if (!backgroundMusic.muted && backgroundMusic.paused) {
                    backgroundMusic.play().catch(error => {
                        console.warn("ç„¡æ³•è‡ªå‹•æ’­æ”¾èƒŒæ™¯éŸ³æ¨‚ï¼Œå¯èƒ½éœ€è¦ç”¨æˆ¶å†æ¬¡äº’å‹•ã€‚", error);
                    });
                }
            });

            // å–®æ›²å¾ªç’°æŒ‰éˆ•ç›£è½å™¨
            singleLoopToggleBtn.addEventListener('click', () => {
                isSingleLoop = !isSingleLoop;
                backgroundMusic.loop = isSingleLoop; // æ›´æ–° audio å…ƒç´ çš„ loop å±¬æ€§
                singleLoopToggleBtn.classList.toggle('active', isSingleLoop);
                localStorage.setItem('isSingleLoop', isSingleLoop); // ä¿å­˜ç‹€æ…‹
                
                // å¦‚æœå–æ¶ˆå–®æ›²å¾ªç’°ï¼Œä¸”éŸ³æ¨‚å› ç‚ºå¾ªç’°çµæŸè€Œæš«åœäº†ï¼ˆå¦‚æœä¹‹å‰æ˜¯æ‰‹å‹•æ’­æ”¾æˆ–å› éŒ¯èª¤æš«åœï¼‰
                // å‰‡å˜—è©¦æ’­æ”¾ä¸‹ä¸€é¦– (åƒ…ç•¶å‰éŸ³é »æºå·²è¨­ç½®ä¸”å·²æš«åœæ™‚)
                if (!isSingleLoop && backgroundMusic.paused && backgroundMusic.src) {
                    // å¦‚æœ backgroundMusic.loop ä¹‹å‰æ˜¯ trueï¼Œendedäº‹ä»¶ä¸æœƒè§¸ç™¼ï¼Œæ‰€ä»¥é€™è£¡æ‰‹å‹•è§¸ç™¼ä¸‹ä¸€é¦–
                    currentAudioIndex = (currentAudioIndex + 1) % audioPlaylist.length;
                    playAudioByIndex(currentAudioIndex);
                }
            });

            // æ­Œæ›²åˆ—è¡¨é»æ“Šäº‹ä»¶å§”è¨—
            songListElement.addEventListener('click', (event) => {
                const clickedItem = event.target.closest('.song-item');
                if (clickedItem) {
                    const index = parseInt(clickedItem.dataset.index, 10);
                    if (!isNaN(index) && index >= 0 && index < audioPlaylist.length) {
                        playAudioByIndex(index, true); // å¼·åˆ¶æ’­æ”¾ï¼Œç”¨æˆ¶é¸æ“‡å„ªå…ˆ
                        hideModal(settingsModal); // æ’­æ”¾å¾Œé—œé–‰è¨­å®šé 
                    }
                }
            });
        }
        
        // æ¸²æŸ“æ­Œæ›²åˆ—è¡¨
        function renderSongList() {
            songListElement.innerHTML = ''; // æ¸…ç©ºç¾æœ‰åˆ—è¡¨
            if (audioPlaylist.length === 0) {
                songListElement.innerHTML = '<li>æ²’æœ‰å¯ç”¨çš„èƒŒæ™¯éŸ³æ¨‚ã€‚</li>';
                return;
            }
            audioPlaylist.forEach((song, index) => {
                const li = document.createElement('li');
                li.classList.add('song-item');
                li.dataset.index = index; // å„²å­˜ç´¢å¼•ï¼Œæ–¹ä¾¿é»æ“Šæ™‚ç²å–
                li.textContent = song.name;

                // é«˜äº®ç•¶å‰æ’­æ”¾çš„æ­Œæ›²
                if (index === currentAudioIndex && !backgroundMusic.paused && backgroundMusic.src === song.path) {
                    li.classList.add('active');
                }
                songListElement.appendChild(li);
            });
        }

        // é¡¯ç¤ºè¨­å®šæ¨¡æ…‹æ¡†
        function showSettingsModal() {
            showModal(settingsModal);
            renderSongList(); // æ¯æ¬¡æ‰“é–‹è¨­å®šéƒ½é‡æ–°æ¸²æŸ“åˆ—è¡¨ï¼Œç¢ºä¿ç‹€æ…‹æ­£ç¢º
            
            // ç¢ºä¿è¨­å®šæ¨¡æ…‹æ¡†æ‰“é–‹æ™‚ï¼ŒéŸ³é‡æ»‘å¡Šå’ŒéœéŸ³ç‹€æ…‹åŒæ­¥
            volumeSlider.value = backgroundMusic.volume;
            if (backgroundMusic.muted) {
                volumeSlider.value = 0;
            }
            // ç¢ºä¿éŸ³é‡æ»‘å¡Šå’ŒéœéŸ³æŒ‰éˆ•çš„ç¦ç”¨ç‹€æ…‹æ­£ç¢º
            if (localStorage.getItem('audioControlsDisabled') === 'true') {
                volumeSlider.disabled = true;
                muteToggleBtn.disabled = true;
                singleLoopToggleBtn.disabled = true;
            } else {
                volumeSlider.disabled = false;
                muteToggleBtn.disabled = false;
                singleLoopToggleBtn.disabled = false;
            }
            singleLoopToggleBtn.classList.toggle('active', isSingleLoop); // æ›´æ–°å–®æ›²å¾ªç’°æŒ‰éˆ•
            updateMuteIcon(); 
        }

        // è¨­å®šé€£çµé»æ“Šäº‹ä»¶
        settingsLink.addEventListener('click', (event) => {
            event.preventDefault();
            showSettingsModal();
            if (document.body.classList.contains('sidebar-open')) {
                toggleSidebar();
            }

            // **æ–°é‚è¼¯ï¼šå¦‚æœéŸ³æ¨‚æ²’æœ‰æ­£åœ¨æ’­æ”¾æˆ–ä¹‹å‰å·²ç¦ç”¨ï¼Œå‰‡é‡æ–°æœç´¢**
            const audioDisabledPermanently = localStorage.getItem('audioControlsDisabled') === 'true';
            // backgroundMusic.paused ç‚º true çš„æƒ…æ³åŒ…æ‹¬:
            // 1. æ­Œæ›²æ’­æ”¾å®Œç•¢ (éloop)
            // 2. è¢«æ‰‹å‹•æš«åœ
            // 3. ç€è¦½å™¨é˜»æ­¢äº†è‡ªå‹•æ’­æ”¾
            // backgroundMusic.src === '' æ„å‘³è‘—æ²’æœ‰ä»»ä½•æ­Œæ›²è¼‰å…¥
            if (backgroundMusic.paused || backgroundMusic.src === '' || audioDisabledPermanently) {
                console.log("åµæ¸¬åˆ°éŸ³æ¨‚æœªæ’­æ”¾æˆ–ä¸Šæ¬¡å˜—è©¦å¤±æ•—/æ°¸ä¹…ç¦ç”¨ï¼Œé‡æ–°æœç´¢éŸ³æ¨‚ã€‚");
                failedAttemptsCount = 0; // é‡ç½®å¤±æ•—è¨ˆæ•¸
                currentAudioIndex = 0; // å¾ç¬¬ä¸€é¦–æ­Œæ›²é–‹å§‹å˜—è©¦
                enableAudioControls(); // é‡æ–°å•Ÿç”¨æ§åˆ¶ï¼ˆåœ¨å˜—è©¦æ’­æ”¾ä¹‹å‰ï¼‰
                playAudioByIndex(currentAudioIndex, true); // å¼·åˆ¶æ’­æ”¾å˜—è©¦
            }
        });
        closeSettingsModalBtn.addEventListener('click', () => hideModal(settingsModal));


        // --- é …ç›®è³‡æ–™èˆ‡æ¸²æŸ“ ---
        const projects = [
            { title: 'ç¡å¤¢éŠæˆ²', url: 'https://gabriel-0927.github.io/sleeping/sleep.html', description: 'ä¸€æ¬¾æ¢ç´¢å¤¢å¢ƒèˆ‡ç¾å¯¦çš„å¥‡å¹»éŠæˆ²ï¼Œåœ¨ç¡å¤¢ä¸­è§£é–‹è¬é¡Œï¼Œå°‹æ‰¾çœŸç›¸ã€‚', localImage: 'images/sleeping-game.jpg', fallbackImage: 'https://images.pexels.com/photos/1624496/pexels-photo-1624496.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', category: ['æ‰‹éŠ', 'æ¡Œæ©ŸéŠæˆ²'] },
            { title: 'è²“å’ªå¤§äº‚é¬¥', url: 'https://gabriel-0927.github.io/Cat-brawl/', description: 'é›†çµä½ çš„è²“å’ªè»åœ˜ï¼å……æ»¿ç­–ç•¥èˆ‡è¶£å‘³çš„å¡”é˜²å°æˆ°éŠæˆ²ï¼ŒèŒè²“å‡ºæ“Šï¼Œç„¡äººèƒ½æ•µã€‚', localImage: 'images/cat-brawl.jpg', fallbackImage: 'https://images.pexels.com/photos/1741205/pexels-photo-1741205.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', category: ['æ‰‹éŠ', 'æ¡Œæ©ŸéŠæˆ²'] },
            { title: 'é»ƒé‡‘ç¤¦å·¥', url: 'https://gabriel-0927.github.io/gold-miner/', description: 'ç¶“å…¸é‡ç¾ï¼æ“ä½œä½ çš„é‰¤çˆªï¼Œåœ¨é™å®šæ™‚é–“å…§æŠ“å–åœ°ä¸‹çš„é»ƒé‡‘èˆ‡å¯¶è—ï¼ŒæŒ‘æˆ°é«˜åˆ†ã€‚', localImage: 'images/gold-miner.jpg', fallbackImage: 'https://images.pexels.com/photos/85768/gold-gold-nugget-nuggets-minerals-85768.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', category: ['æ‰‹éŠ', 'æ¡Œæ©ŸéŠæˆ²'] },
            { title: 'å¢æ—æ±‚ç”Ÿ', url: 'https://rex971008.github.io/Jungle-Survival2/JungleSurvival.html', description: 'ä½ å¢œè½åœ¨æœªçŸ¥çš„å¢æ—ä¸­ï¼Œå¿…é ˆåˆ©ç”¨æ™ºæ…§å’Œå‹‡æ°£ï¼Œå°‹æ‰¾è³‡æºï¼Œå»ºé€ åº‡è­·æ‰€ï¼ŒåŠªåŠ›æ´»ä¸‹å»ã€‚', localImage: 'images/jungle-survival.jpg', fallbackImage: 'https://images.pexels.com/photos/1528640/pexels-photo-1528640.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', category: ['æ‰‹éŠ', 'æ¡Œæ©ŸéŠæˆ²'] },
            { title: 'è¿·å®®éŠæˆ²', url: 'https://rex971008.github.io/maze/Maze_exploration_games.html', description: 'æŒ‘æˆ°ä½ çš„æ–¹å‘æ„Ÿå’Œé‚è¼¯æ€ç¶­ï¼Œåœ¨è¤‡é›œçš„è¿·å®®ä¸­æ‰¾åˆ°å”¯ä¸€çš„å‡ºå£ï¼Œä½ èƒ½å¤šå¿«å®Œæˆï¼Ÿ', localImage: 'images/maze-game.jpg', fallbackImage: 'https://images.pexels.com/photos/158471/pexels-photo-158471.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', category: ['æ‰‹éŠ', 'æ¡Œæ©ŸéŠæˆ²'] },
            { title: 'æ”¶é›†æ˜Ÿæ˜Ÿ', url: 'https://rex971008.github.io/starcollect/starcollect.html', description: 'åœ¨é™å®šæ™‚é–“å…§æ”¶é›†æ‰€æœ‰é–ƒçˆçš„æ˜Ÿæ˜Ÿï¼ŒæŒ‘æˆ°ä½ çš„åæ‡‰é€Ÿåº¦å’Œæ“ä½œæŠ€å·§ã€‚', localImage: 'images/star-collect.jpg', fallbackImage: 'https://images.pexels.com/photos/1252890/pexels-photo-1252890.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', category: ['æ‰‹éŠ', 'æ¡Œæ©ŸéŠæˆ²'] },
            { title: 'è³½è»Šèµ·è·‘', url: 'https://rex971008.github.io/racingstart/racing%20start.html', description: 'å±ä½å‘¼å¸ï¼Œåœ¨ä¿¡è™Ÿç‡ˆç†„æ»…çš„ç¬é–“å®Œç¾èµ·è·‘ï¼è€ƒé©—ä½ æ¥µé™åæ‡‰çš„è³½è»ŠéŠæˆ²ã€‚', localImage: 'images/racing-start.jpg', fallbackImage: 'https://images.pexels.com/photos/3802510/pexels-photo-3802510.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', category: ['æ‰‹éŠ', 'æ¡Œæ©ŸéŠæˆ²'] },
            { title: 'èƒ¡é¬§è²“å»šæˆ¿', url: 'https://rex971008.github.io/kitchen_katterwaul/kitchen_katterwaul.html', description: 'èˆ‡æœ‹å‹åˆä½œæˆ–å°æŠ—ï¼Œåœ¨æ··äº‚çš„å»šæˆ¿ä¸­å®Œæˆè¨‚å–®ï¼è€ƒé©—ä½ å€‘çš„é»˜å¥‘èˆ‡åæ‡‰ã€‚', localImage: 'images/kitchen-katterwaul.jpg', fallbackImage: 'https://images.pexels.com/photos/887827/pexels-photo-887827.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', category: ['æ‰‹éŠ', 'æ¡Œæ©ŸéŠæˆ²'] },
            { title: 'ä½ ç•«æˆ‘çŒœ', url: 'https://gabriel-0927.github.io/draw/draw.html', description: 'å…ä¸‹è¼‰ï¼Œç›´æ¥é–‹ç©ã€‚ä¸€äººç•«åœ–ï¼Œå¤§å®¶çŒœè©ï¼Œè€ƒé©—ä½ çš„ç¹ªç•«åŠŸåŠ›èˆ‡çŒœè¬é€Ÿåº¦ï¼å¿«æªæœ‹å‹æ¯”ç•«ã€æ¯”çŒœï¼', localImage: 'images/ai-drawing.jpg', fallbackImage: 'https://images.pexels.com/photos/8386440/pexels-photo-8386440.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', category: ['æ‰‹éŠ', 'æ¡Œæ©ŸéŠæˆ²'] },
            { title: 'ChromaShock Arena', url: 'https://rex971008.github.io/ChromaShockArena/', description: 'é€²å…¥è‰²å½©æ–‘æ–•çš„ç«¶æŠ€å ´ï¼Œé«”é©—å¿«ç¯€å¥çš„å°„æ“Šå°æ±ºã€‚ç²¾æº–çš„æ§æ³•å’Œéˆæ´»çš„èµ°ä½æ˜¯è‡´å‹é—œéµã€‚', localImage: 'images/chromashock-arena.jpg', fallbackImage: 'https://images.unsplash.com/photo-1552820728-8b83bb6b773f?auto=format&fit=crop&q=80&w=1470', category: ['æ¡Œæ©ŸéŠæˆ²'] },
            { title: 'TOUR EATS', url: 'https://rex971008.github.io/tour_eats_v1.1/code.html', description: 'çµåˆæ—…éŠèˆ‡ç¾é£Ÿçš„æ¢ç´¢æ‡‰ç”¨ã€‚ç™¼ç¾ä½ æ‰€åœ¨åœ°çš„ç‰¹è‰²é¤å»³ï¼Œè¦åŠƒä¸€å ´å®Œç¾çš„å‘³è•¾ä¹‹æ—…ã€‚', localImage: 'images/tour-eats.jpg', fallbackImage: 'https://images.unsplash.com/photo-1555939594-58d7cb561ad1?auto=format&fit=crop&q=80&w=1374', category: ['æ‡‰ç”¨'] },
            { title: 'å–®å­—å¡', url: 'https://rex971008.github.io/flashcard/flashcard.html', description: 'ä¸€å€‹ç°¡æ½”æœ‰æ•ˆçš„å–®å­—å¡æ‡‰ç”¨ï¼Œå¹«åŠ©æ‚¨å­¸ç¿’å’Œè¨˜æ†¶æ–°è©å½™ï¼Œè®“è¤‡ç¿’äº‹åŠåŠŸå€ã€‚', localImage: 'images/flashcard.jpg', fallbackImage: 'https://images.unsplash.com/photo-1456513080510-7bf3a84b82f8?auto=format&fit=crop&q=80&w=1470', category: ['æ‡‰ç”¨'] },
            { title: 'æ‹è²¼æ©Ÿ', url: 'https://stellar-muffin-de6334.netlify.app/', description: 'é¸æ“‡å–œæ­¡çš„ç›¸æ¡†ï¼Œè£½ä½œå±¬æ–¼ä½ çš„å€‹æ€§åŒ–æ‹è²¼ç…§ç‰‡ï¼Œç•™ä¸‹ç¾å¥½å›æ†¶ã€‚', localImage: 'images/photo-booth.jpg', fallbackImage: 'https://images.pexels.com/photos/1090638/pexels-photo-1090638.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', category: ['æ‡‰ç”¨'] },
            { title: 'å®˜æ–¹ç¶²ç«™ (v2.4.7)', url: 'https://sage-stardust-00287b.netlify.app/', description: 'åœ˜éšŠæˆ–å€‹äººçš„å®˜æ–¹é–€æˆ¶ï¼Œå±•ç¤ºæ ¸å¿ƒç†å¿µã€æœ€æ–°å‹•æ…‹èˆ‡æ‰€æœ‰å°ˆæ¡ˆçš„é›†åˆåœ°ã€‚å…¨æ–°çš„å®¢æœç³»çµ±èˆ‡é–±æ­·é»é¤ç³»çµ±å°‡æœƒæ–¼æœªä¾†å¯¦éš›é‹ç”¨ã€‚å»ºè­°å‰µå»ºå¸³è™Ÿä¸¦ä¸”å…è¨±é€šçŸ¥ã€‚', localImage: 'images/official-website.jpg', fallbackImage: 'https://images.pexels.com/photos/326503/pexels-photo-326503.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1', category: ['æ‡‰ç”¨'] }
        ];

        const cardContainer = document.getElementById('card-container');
        const searchBox = document.getElementById('search-box');
        const filterButtons = document.querySelectorAll('.filter-btn');
        let processedProjects = [];

        const toggleBtn = document.getElementById('toggle-filters-btn');
        const collapsibleMenu = document.getElementById('collapsible-menu');

        function updateMenuState(isOpen) {
            collapsibleMenu.classList.toggle('is-open', isOpen);
            toggleBtn.setAttribute('aria-expanded', isOpen);
            toggleBtn.textContent = isOpen ? 'æ”¶åˆ â–²' : 'ç¯©é¸ â–¼';
        }

        toggleBtn.addEventListener('click', () => {
            const isOpen = !collapsibleMenu.classList.contains('is-open');
            updateMenuState(isOpen);
        });

        function handleOutsideInteraction(event) {
            if (!collapsibleMenu.classList.contains('is-open')) return;
            if (toggleBtn.contains(event.target) || collapsibleMenu.contains(event.target)) return;
            updateMenuState(false);
        }

        document.addEventListener('click', handleOutsideInteraction);
        document.addEventListener('touchstart', handleOutsideInteraction);

        function checkImage(localPath, fallbackPath) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve(localPath);
                img.onerror = () => resolve(fallbackPath);
                img.src = localPath;
            });
        }
        
        function renderCards(projectsToRender) {
            cardContainer.innerHTML = '';
            if (projectsToRender.length === 0) {
                cardContainer.innerHTML = '<p style="color: var(--text-muted); font-size: 1.2rem; grid-column: 1 / -1; text-align: center;">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„é …ç›®...<p>';
                return;
            }
            const categoryClassMap = { 'æ‰‹éŠ': 'mobile-game', 'æ¡Œæ©ŸéŠæˆ²': 'desktop-game', 'æ‡‰ç”¨': 'app' };
            projectsToRender.forEach(project => {
                const tagsHTML = project.category.map(cat => `<span class="category-tag ${categoryClassMap[cat] || ''}">${cat}</span>`).join('');
                cardContainer.innerHTML += `
                    <div class="card" data-game-url="${project.url}">
                        <div class="card-image" style="background-image: url('${project.finalImage}')"></div>
                        <div class="card-content"><h3>${project.title}</h3><p>${project.description}</p>
                            <div class="card-footer"><div class="tags-container">${tagsHTML}</div></div>
                        </div>
                    </div>`;
            });
        }

        function filterAndSearch() {
            const searchTerm = searchBox.value.toLowerCase();
            const activeFilter = document.querySelector('.filter-btn.active').dataset.filter;
            const filteredProjects = processedProjects.filter(project => 
                (activeFilter === 'all' || project.category.includes(activeFilter)) && project.title.toLowerCase().includes(searchTerm)
            );
            renderCards(filteredProjects);
        }

        async function initializePage() {
            const imageChecks = projects.map(p => checkImage(p.localImage, p.fallbackImage));
            const finalImagePaths = await Promise.all(imageChecks);
            processedProjects = projects.map((project, index) => ({ ...project, finalImage: finalImagePaths[index] }));
            
            filterAndSearch();

            cardContainer.addEventListener('click', (event) => {
                const card = event.target.closest('.card');
                if (card && card.dataset.gameUrl) {
                    event.preventDefault();
                    showGameModal(card.dataset.gameUrl);
                }
            });

            searchBox.addEventListener('input', filterAndSearch);
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    filterAndSearch();
                });
            });

            initializeAudioControls();
        }

        initializePage();
    });
    </script>

</body>
</html>